name: Frontend Documentation

on:
  push:
    branches: ['*']
    paths:
      - 'bulak-smart-connect-js/src/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install Gatsby CLI
        run: npm install -g gatsby-cli
      
      - name: Create Gatsby Documentation Site
        run: |
          # Create a new Gatsby site using the documentation starter
          gatsby new docs-site https://github.com/gatsbyjs/gatsby-starter-documentation
          
          cd docs-site
          
          # Install additional dependencies for component documentation
          npm install --save gatsby-plugin-mdx @mdx-js/react @mdx-js/mdx gatsby-source-filesystem prism-react-renderer react-live

      - name: Configure Gatsby Site
        run: |
          cd docs-site
          
          # Create gatsby-config.js with component documentation setup
          cat > gatsby-config.js << 'EOF'
          module.exports = {
            siteMetadata: {
              title: 'Bulak Smart Connect Documentation',
              description: 'Component documentation for Bulak Smart Connect',
              author: 'Bulak LGU Smart Connect Team',
            },
            plugins: [
              'gatsby-plugin-react-helmet',
              {
                resolve: 'gatsby-source-filesystem',
                options: {
                  name: 'components',
                  path: `${__dirname}/src/components`,
                },
              },
              {
                resolve: 'gatsby-source-filesystem',
                options: {
                  name: 'project-components',
                  path: `${__dirname}/../bulak-smart-connect-js/src`,
                },
              },
              {
                resolve: 'gatsby-source-filesystem',
                options: {
                  name: 'pages',
                  path: `${__dirname}/src/pages`,
                },
              },
              {
                resolve: 'gatsby-plugin-mdx',
                options: {
                  defaultLayouts: {
                    default: require.resolve('./src/components/layout.js'),
                  },
                  gatsbyRemarkPlugins: [
                    {
                      resolve: 'gatsby-remark-prismjs',
                      options: {
                        classPrefix: 'language-',
                        inlineCodeMarker: null,
                        aliases: {},
                        showLineNumbers: true,
                      },
                    },
                  ],
                },
              },
              'gatsby-plugin-catch-links',
            ],
          };
          EOF

      - name: Create Component Documentation
        run: |
          cd docs-site
          
          # Create documentation structure
          mkdir -p src/pages/components
          mkdir -p src/components
          
          # Create Introduction page
          cat > src/pages/index.mdx << 'EOF'
          # Bulak Smart Connect Documentation
          
          Welcome to the Bulak Smart Connect component library documentation.
          
          This site provides documentation for the React components used in the Bulak Smart Connect application,
          which serves as the official queuing and information system for the Municipal Civil Registrar
          of San Ildefonso, Bulacan.
          
          ## Design Principles
          
          - **User-Centered**: Components focus on ease of use for citizens
          - **Consistency**: Uniform styling and behavior across the application
          - **Accessibility**: Components follow WCAG guidelines
          - **Responsiveness**: Works on desktop and mobile devices
          
          ## Main Component Categories
          
          - [Landing Page Components](/components/landing-page)
          - [Navigation Components](/components/navigation)
          - [User Dashboard Components](/components/user-dashboard)
          - [Admin Components](/components/admin)
          - [Authentication Components](/components/auth)
          EOF
          
          # Create component categories pages
          cat > src/pages/components/landing-page.mdx << 'EOF'
          # Landing Page Components
          
          Components used on the public-facing landing page.
          
          ## Color Scheme
          
          The landing page uses the primary color scheme:
          
          - Primary: #184a5b
          - Secondary: #8DC3A7
          - Accent: #e2e381
          
          ## Components
          
          ### HeroSection
          
          The main banner section at the top of the landing page.
          
          ### FeatureCard
          
          Cards displaying the key features of the application.
          EOF
          
          # Create a simple layout component
          cat > src/components/layout.js << 'EOF'
          import React from 'react';
          import { Link } from 'gatsby';
          import './layout.css';
          
          const Layout = ({ children }) => {
            return (
              <div className="main-container">
                <header>
                  <nav>
                    <Link to="/" className="site-title">Bulak Smart Connect Docs</Link>
                    <div className="nav-links">
                      <Link to="/components/landing-page">Landing Page</Link>
                      <Link to="/components/navigation">Navigation</Link>
                      <Link to="/components/user-dashboard">User Dashboard</Link>
                      <Link to="/components/admin">Admin</Link>
                      <Link to="/components/auth">Auth</Link>
                    </div>
                  </nav>
                </header>
                <main>{children}</main>
                <footer>
                  <p>Â© {new Date().getFullYear()} Bulak Smart Connect</p>
                </footer>
              </div>
            );
          };
          
          export default Layout;
          EOF
          
          # Create layout CSS
          cat > src/components/layout.css << 'EOF'
          :root {
            --primary-color: #184a5b;
            --secondary-color: #8DC3A7;
            --accent-color: #e2e381;
            --text-color: #333333;
            --background-color: #ffffff;
            --sidebar-width: 250px;
          }
          
          * {
            box-sizing: border-box;
          }
          
          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
              Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: var(--background-color);
          }
          
          .main-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
          }
          
          header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
          }
          
          nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
          }
          
          .site-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-decoration: none;
          }
          
          .nav-links {
            display: flex;
            gap: 1.5rem;
          }
          
          .nav-links a {
            color: white;
            text-decoration: none;
          }
          
          .nav-links a:hover {
            text-decoration: underline;
          }
          
          main {
            flex-grow: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem;
          }
          
          footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1rem;
          }
          EOF
          
          # Create a Button component example
          cat > src/pages/components/button.mdx << 'EOF'
          # Button Component
          
          A customizable button component for user interactions.
          
          ## Usage
          
          ```jsx
          import Button from '../components/Button';
          
          <Button 
            primary 
            label="Click Me" 
            onClick={() => alert('Button clicked!')} 
          />
          ```
          
          ## Props
          
          | Prop | Type | Default | Description |
          | ---- | ---- | ------- | ----------- |
          | `label` | string | required | Text to display inside the button |
          | `primary` | boolean | false | Whether the button should use primary styling |
          | `onClick` | function | () => {} | Function called when button is clicked |
          | `disabled` | boolean | false | Whether the button is disabled |
          EOF
          
      - name: Copy Project Components for Documentation
        run: |
          cd docs-site
          
          # Create directory for component examples
          mkdir -p src/components/examples
          
          # Copy a sample of your project components
          cp -r ../bulak-smart-connect-js/src/components/* src/components/examples/ 2>/dev/null || :
          cp -r ../bulak-smart-connect-js/src/LandingPageComponents/* src/components/examples/ 2>/dev/null || :
          cp -r ../bulak-smart-connect-js/src/NavigationComponents/* src/components/examples/ 2>/dev/null || :
      
      - name: Build Gatsby Site
        run: |
          cd docs-site
          gatsby build --prefix-paths
          touch public/.nojekyll
      
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: docs-site/public
          target-folder: frontend-docs
          branch: gh-pages
          clean: true
          clean-exclude: |
            .nojekyll
            api-docs/**

      - name: Create Documentation Hub
        run: |
          mkdir -p doc_hub
          touch doc_hub/.nojekyll
          
          cat > doc_hub/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
            <head>
              <meta charset="utf-8">
              <title>Bulak Smart Connect Documentation Hub</title>
              <style>
                body { 
                  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                  max-width: 800px;
                  margin: 0 auto;
                  padding: 20px;
                  line-height: 1.6;
                }
                .header {
                  text-align: center;
                  padding: 20px 0;
                  margin-bottom: 40px;
                  border-bottom: 1px solid #eaeaea;
                }
                .header h1 {
                  color: #184a5b;
                  margin-bottom: 10px;
                }
                .card {
                  border: 1px solid #e0e0e0;
                  border-radius: 8px;
                  padding: 24px;
                  margin-bottom: 24px;
                  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                  transition: transform 0.2s, box-shadow 0.2s;
                }
                .card:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }
                .card h2 {
                  margin-top: 0;
                  color: #184a5b;
                }
                .button {
                  display: inline-block;
                  background-color: #184a5b;
                  color: white;
                  padding: 10px 20px;
                  text-decoration: none;
                  border-radius: 4px;
                  margin-top: 10px;
                  font-weight: 500;
                  transition: background-color 0.2s;
                }
                .button:hover {
                  background-color: #0d3446;
                }
                .footer {
                  text-align: center;
                  color: #666;
                  margin-top: 40px;
                  padding-top: 20px;
                  border-top: 1px solid #eaeaea;
                  font-size: 0.9em;
                }
              </style>
            </head>
            <body>
              <div class="header">
                <h1>Bulak Smart Connect</h1>
                <p>Comprehensive Documentation Hub</p>
              </div>
              
              <div class="card">
                <h2>API Documentation</h2>
                <p>Backend API documentation generated with Compodoc, providing detailed information about endpoints, services, and models.</p>
                <a href="api-docs/" class="button">View API Docs</a>
              </div>
              
              <div class="card">
                <h2>Component Documentation</h2>
                <p>Frontend component documentation built with Gatsby, showing components, props, and usage examples.</p>
                <a href="frontend-docs/" class="button">View Components</a>
              </div>
              
              <div class="footer">
                <p>Â© $(date +%Y) Bulak Smart Connect</p>
              </div>
            </body>
          </html>
          EOF

      - name: Deploy Documentation Hub
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: doc_hub
          branch: gh-pages
          clean: false